



# 常见问题

## <font color=#A52A2A  >__快速接入开发者中心常见问题__</font>

> __1.设备初始化需要做什么__ <br>
> 答：QuecThing的初始化配置必须完成以下几步的操作。
> ```c
>    /* 初始化QuecThing SDK */
>    Ql_iotInit();
>    /* 注册事件回调函数 */
>    Ql_iotConfigSetEventCB(Ql_iotEventCB);
>    /* 配置产品信息*/
>   Ql_iotConfigSetProductinfo("pxxxxt", "VzZUxxxxxxxxxx9E");
> ```

> __2.ProductKey和ProductSecret是什么？从哪里获取ProductKey和ProductSecret？__ <br>
> 答：ProductKey(简称PK)和ProductSecret(简称PS)分别是产品号和产品密钥，是产品的唯一标识，产品下所有设备都使用同一个PK和PS。在[开发者中心](https://iot.quectelcn.com/login?redirect=%2Fproject%2Flist)
> 创建产品时，PK和PS会自动下发到平台注册时所使用的邮箱。

> __3.事件回调是什么？__ <br>
> 答：事件回调处理接口简单的说就是为事件源(组件)添加一个监听任务 __Ql_iotEventCB()__ ，当用户触发了某件事件时，交给监听器去处理，开发者既可根据不同的事件来执行不同的操作。

> __4.如何连接开发者中心？__ <br>
> 答：在完成初始化后，调用 __Ql_iotConfigSetConnmode(1)__ 即可连接开发者中心。

> __5.如何确定当前设备已连接开发者中心？__ <br>
> 答：模组调用 __Ql_iotGetWorkState()__ 函数可查询当前设备与平台之间的连接状态，若返回值为 __8__ 则确保模组已订阅上开发者中心并且可进行数据业务交互。

> __6.设备连接开发者中心之前，我需要配置服务器信息吗？__ <br>
> 答：模组已有默认服务器信息，若无特殊需求则可无需配置。<br>

> __7.设备生命周期(lifetime)是什么？设备连接开发者中心之前我需要设置吗？__ <br>
> 答：设备生命周期(lifetime)，指的是协议内部的心跳时间，一般没有特殊要求不需要设置，使用默认值(120s)即可。<br>

> __8.设备的“MCU编号及其对应的版本号”是什么？设备连接开发者中心之前我需要设置吗？__ <br>
> 答：“MCU编号及其对应的版本号”是当您需要通过模组给设备上的MCU进行SOTA升级时，才需要设置。当设备没有MCU，或者不需要给MCU升级时，不需要设置。

> __8. PDP上下文ID(contextID)是什么？设备连接开发者中心之前我需要设置吗？__ <br>
> 答：contextID是当模组除了使用上云功能以外，还需要使用模组进行其他传输业务时才需要设置的，若无特殊需求则可不需要进行配置。<br>

> __9.设备与平台之间的连接加密模式是什么？设备连接开发者中心之前我需要设置吗？__ <br>
> 答：数据链路的一种加密模式，可选项，默认关闭。<br>

> __10.设备连接平台之前，我需要配置设备表示(DeviceKey) 和设备密钥(DeviceSecret) 吗？__ <br>
> 答：__DeviceKey__ 一般不需要特别设置，在不设置的情况下，模组默认使用IMEI（蜂窝模组）或者MAC地址（WIFI模组）作为 __DeviceKey__。 __DeviceSecret__ 不需要配置，模组第一次连接平台时，平台会生成 __DeviceSecret__ 并下发给模组（此步骤用户无感知）。

> __11.设备如何在开发者中心认证？如何激活？__ <br>
> 答：设备在初次连接上开发者中心时，会自动认证。设备上行一条数据或平台下行一条数据后就会被激活。<br>

> __12.为什么设备连接平台时失败，事件回调码打印 "1,10422" ？__ <br>
> 答：出现此等情况，一般是切换产品导致模组保存的DS与产品DS对应不上失败，或者是烧录固件时覆盖了配置文件导致模组保存的DS清除了。
> 需要在平台重置一下DeviceSecret，设备再重新上线即可。<br>

## <font color=#A52A2A  >__数据业务常见问题__</font>
> __1.数据格式有几种？__ <br>
> 答：数据格式有两种，分别为物模型与透传。

> __2.物模型是什么？__ <br>
> 答：物模型是指设备在开发者中心的数字化表示，并在云端构建的实体数据模型，并分为属性、服务和事件三个维度。

> __3.透传数据格式是什么？__ <br>
> 答：透传数据格式是指设备上报透传数据到开发者中心，云平台不做任何数据解析。

> __4.QoS是什么？__ <br>
> 答：QoS（Quality of Service）是服务质量的简称，提高服务质量无非也就是保证传输的带宽，降低数据的丢包率以及时延抖动等，可根据实际的网络状态选择相对应的Qos。
> * QoS 当前有三个等级（0，1，2）：<br>
> * 若设备与平台间需要高频且不可靠交互时，处于流量节省和高效性上，可选择QoS为0。<br>
> * 若设备与平台间需要高频且需可靠交互时，处于流量节省和高效性上，可选择QoS为1。<br>
> * 若设备与平台间需要高频且需可靠交互时，且需要严格遵循一发一收原则，可选择QoS为2。<br>

> __5.PkgID是什么？__ <br>
> 答：PkgID是上下行数据包的ID。例如开发者在连续多次发送上述类型数据时，可能无法判别是哪个数据成功或失败，所以在此增加发送时先返回PkgID，在成功发送到平台时再通知给开发者该PkgID，开发者可以根据两次的PkgID来判别是否成功。

> __6.如何发送物模型到开发者中心？__ <br>
> 答：调用 __Ql_iotCmdBusPhymodelReport_ex()__ 函数即可向开发者中心发送物模型数据。

> __7.如何接收物模型数据？__ <br>
> 答：当开发者中心下发物模型数据时，设备接收到数据会自动进入回调函数{5,10210}，您可调用 __Ql_iotTtlvCountGet()__ 与 __Ql_iotTtlvNodeGet()__ 函数获取及解析TTLV数据。详情请参考物模型格式数据业务交互示例。

> __8.如何应答开发者中心请求的物模型数据？__ <br>
> 答：调用 __Ql_iotCmdBusPhymodelAck()__ 函数即可应答开发者中心发送物模型数据。

> __9.设备上报事件时，一定要携带属性参数吗？__ <br>
> 答：设备上报事件时，可以携带不带参数。 <br>

> __10.设备上报物模型数据时，可以同时上报属性和事件吗？__ <br>
> 答：可以，设备上报物模型数据可以一次性将多条属性和事件同时上报。<br>  


## <font color=#A52A2A  >__OTA升级常见问题__</font>
> __1.OTA是什么意思？__ <br>
> 答：OTA是指在线网络升级。可将升级固件包上传到开发者中心并创建好升级计划，当设备环境满足升级策略后，MCU需主动触发平台计划与确认升级。

> __2.DMP OTA分为几种，分别是什么？__ <br>
> 答：DMP OTA分为两种，分别是FOTA（模组固件升级）、SOTA（MCU固件升级）。

> __3.我该如何选择OTA？__ <br>
> 答：根据项目需求来定，若是给MCU升级程序则选择SOTA，若是给模组升级则选择FOTA。
> * 若用户需要在模组固件基础上进行二次开发，则需使用FOTA方式进行升级。<br>
> * 若用户使用移远模组与自身开发的设备进行开发，则需使用SOTA方式进行升级。<br>

> __4.整包和差分包的区别？__ <br>
> 答：<br>
>  1、制作方式 <br>
>   整包和差分包均是可以实现固件升级,整包是用户工程通过编译器编译完整代码生成的固件；
> 而差分包是通过对比上一个版本的代码差异从而生成可插入原有的固件的固件(可称为补丁)，其需要使用特定的工具方可生成。<br>
>  2、流量 <br>
>   整包是属于完整工程编译的固件，故一般情况下，文件远大于差分包的大小，因此对于高延时、低带宽或者低功耗设备而言，差分包具备更好的优势。<br>
>  3、兼容性 <br>
>   差分包升级是基于上一个版本的固件进行修整，所以差分包升级无法兼容更低版本升级到最新版本，若需要全部升级，则需要创建多个组件或计划，
> 所以对于大批量多版本设备而言，维护成本偏高。   

> __5.FOTA操作步骤？__ <br>
> 答：<br>
> 1、在开发者中心创建升级模型、升级版本及升级计划。 <br>
> 2、调用 __Ql_iotCmdOtaRequest()__ 函数请求 OTA 升级计划，若设备升级环境满足升级策略即可确认升级。 <br>
> 3、调用 __Ql_iotCmdOtaAction()__ 函数确认升级。 <br>
> 4、模组自动接收升级包后自动进入升级状态。 <br>

> __6.SOTA操作步骤？__ <br>
> 答：<br>
> 1、调用 __Ql_iotConfigSetMcuVersion()__ 函数配置 MCU 版本号。 <br>
> 2、在开发者中心创建升级模型、升级版本及升级计划。 <br>
> 3、调用 __Ql_iotCmdOtaRequest()__ 函数请求 OTA 升级计划，若设备升级环境满足升级策略即可确认升级。 <br>
> 4、调用 __Ql_iotCmdOtaAction()__ 函数确认升级。 <br>
> 5、调用 __Ql_iotCmdOtaMcuFWDataRead()__ 函数分片读取SOTA 数据。 <br>
> 6、MCU接收完整升级包数据后则进入更新状态。 <br>
> 7、MCU升级完毕后设置新的MCU版本号并上传至开发者中心。 <br>

> __7.OTA为什么触发不了？__ <br>
> 答：<br>
> 原因一：当前设备未连接开发者中心。
> 原因二：当前设备的属性不满足计划的要求，如用户剩余空间不足、当前信号弱。
> 原因三：用户所创建的计划不包含该设备。

> __8.OTA为什么会失败？__ <br>
> 答：<br>
> 原因一：请确保当前SDK版本是否符合相关的AT指令，若2.9.2版本前的SDK使用2.9.2版本及之后的AT指令将会衍生不可预知的错误。<br>
> 原因二：若设备处于OTA升级途中，出现设备断电断网获取断开开发者中心连接直至超过计划的生存周期则认为失败。<br>
> 原因三：若设备处于OTA升级途中，出现网络波动并持续一段时间后，设备将认为本次升级失败，并自动重新触发升级，若连续5次均失败，则认为设备于此计划升级中失败。<br>
> 原因四：若设备OTA下载完成更新失败，有可能为更新过程中损坏了升级文件，可关注对存储升级文件区域的操作。<br>

> __9.OTA请求时，调用 Ql_iotCmdOtaRequest(quint32_t mode) 函数时，入口参数 mode 选择0和1有什么区别？__ <br>
> 答：
> * 入口参数 __mode__ 为0时，平台下发计划时不会携带固件的SHA256校验信息；
> * 入口参数 __mode__ 为1时，平台下发升级计划时会携带固件包的SHA256校验信息；<br>
> 您可以根据自己的需求来决定是否需要使用固件的SHA256校验信息。<br>

> __10.为什么SOTA升级时，发送OTA请求指令后，无法收到升级计划？__ <br>
> 答：<br>
>    原因一：平台未创建升级计划或者计划未激活。<br>
>    原因二：模组未设置MCU版本号，需要先调用 __Ql_iotConfigSetMcuVersion()__ 函数设置MCU版本号。 <br>

> __11.为什么SOTA升级时，模组不能一次性下载完升级包？__ <br>
> 答：模组空闲内存不够一次性存放升级包，所以会导致分包下载，模组空闲内存大小因模组型号而异。 <br>    

> __12.为什么SOTA升级时，模组不会自动下载下一块固件数据？__ <br>
> 答：SOTA升级从开发者中心分块下载固件时，在下载完第一块后，需要MCU发送调用 __Ql_iotCmdOtaAction(2)__ 函数才会下载下一块数据。

> __13.设备端如何判断设备OTA是否成功？__ <br>
> 答：当设备OTA升级成功时，设备端会打印事件响应码：__7,10705__ ，或在开发者中心升级计划界面查看计划升级成功。<br>

## <font color=#A52A2A  >__设备定位常见问题__</font>
> __1.设备定位有几种方式？__ <br>
> 答：QuecThing 设备定位有两种，分别是LBS基站定位与GNSS定位。

> __2.LBS基站定位特点？__ <br>
> 答：LBS基站定位覆盖率高室内室外都有信号，定位精度较低，无需外置模组。
> GNSS定位只有室外或空旷的地方有定位信号，定位精度较高，需设备连接外置GNSS模组获取定位数据。

> __3.GNSS定位特点？__
> 答：GNSS定位速度快，全天候作业，不需要考虑目视通视条件，可以远距离大范围测量。但受天顶方向遮盖影响极大，在室内、隧道内精度下降。

> __4.LBS基站定位该如何使用？__ <br>
> 答：QuecThing已包含LBS基站定位组件，只需调用 __Ql_iotLocGetData()__ 函数即可获取设备当前内置定位功能的定位数据。调用 __Ql_iotCmdBusLocReportInside_ex()__ 函数即可上报设备内置定位功能的定位数据。

> __5.GNSS定位该如何使用？__ <br>
> 答：GNSS定位需要外置GNSS模组，需将GNSS模组读取的坐标系读取到模组内，再调用 __Ql_iotCmdBusLocReportOutside_ex()__ 函数上报设备外置定位功能的定位数据。

> __6.我该选择哪种定位方式？__ <br>
> 答：<br>
> 若对设备的定位精度要求不高时，可选择使用LBS定位；<br>
> 若对设备的定位精度要求较高，可选择使用GNSS定位；<br>

> __7.设备端如何判断设备定位数据上报成功？__ <br>
> 答：当设备上报定位数据成功时，模组会打印事件回调码：__+QIOTEVT: 4,10220__ 。 <br>

> __8.为什么发送定位数据失败，返回ERROR？__ <br>
> 答：当前设备还未连接上平台，请在设备连接平台之后再上报定位数据。 <br>

 ## <font color=#A52A2A  >__其他常见问题__</font>
> __1.使用Qflash烧录固件时，烧录失败？__ <br>
> 答：<br>
> 原因一：模组驱动没有安装正确。<br>
> 原图二：固件的存放路径下有中文或者空格。<br>

> __2.为什么设备上报告警事件，移联万物APP没有弹窗提醒？__ <br>
> 答：设备管理平台没有配置消息通知规则，在设备管理平台“产品开发”->“项目”->“产品”->“功能定义”->“消息规则”配置一下即可。  

> __3.开发者中心下行数据时，MCU仿真工具提示无法匹配数据？__ <br>
> 答：MCU仿真工具没有导入物模型，导致工具无法解析平台下发的物模型，需要在工具中导入物模型文件。 <br> 





