# 自定义功能

## **什么是自定义功能**

所谓自定义功能，即可以根据当前产品特定使用场景进行的个性化功能定义。它不与产品品类相关，只在当前产品下产生作用。

## **添加自定义功能**

### **前提条件**

● 已创建数据格式为物模型的产品。

### **操作步骤**

1.登录开发者中心后，点击产品面板或者面板上“设备开发”按钮，则会进入产品开发流程。

<a data-fancybox title="img" href="/guide/image2022-3-3_16-28-9.png">![img](/guide/image2022-3-3_16-28-9.png)</a>

2.在“功能定义”步骤点击面板上“草稿模式”，进入草稿编辑页面。

<a data-fancybox title="img" href="/guide/image2022-3-22_9-58-55.png">![img](/guide/image2022-3-22_9-58-55.png)</a>

3.点击“添加自定义功能”，会出现下图弹框

<a data-fancybox title="img" href="/guide/image2022-3-22_9-59-42.png">![img](/guide/image2022-3-22_9-59-42.png)</a>

您可以为当前产品定义属性、事件、服务。

### **添加自定义属性**

选择功能类型为属性，进行相关参数填充，完成自定义属性创建。

<a data-fancybox title="img" href="/guide/image2022-3-22_9-59-42.png">![img](/guide/image2022-3-22_9-59-42.png)</a>

属性参数说明

| 属性         | 描述                                                                                                                   |
| :----------- |:---------------------------------------------------------------------------------------------------------------------|
| 功能名称     | 属性的名称，例如：用电量。同一产品下功能名称不能重复。支持中文、大小写字母、数字、短划线、下划线、斜杠和小数点，必须以中文、英文或数字开头，不超过 128 个字符                                     |
| 标识符       | 功能定义标识符，与id一一对应，用于应用端与设备交互关键字段。每个物模型版本下属性、事件、服务唯一。                                                                   |
| 数据类型     | 数据类型。INT,FLOAT,DOUBLE,ENUM,TEXT,DATE,STRUCT,ARRAY,BOOL.具体详细见[物模型支持的数据类型](/guide/develop/definition/page-01.md#物模型支持的数据类型) |
| 取值范围     | 当数据类型为数值型（INT/FLOAT/DOUBLE）时，可以对数值的取值范围进行约束                                                                          |
| 步长         | 当数据类型为数值型（INT/FLOAT/DOUBLE）时，可以设置属性变化的最小粒度                                                                           |
| 单位         | 当数据类型为数值型（INT/FLOAT/DOUBLE）时，可以根据业务实际情况选择                                                                  |
| 数据长度     | 当数据类型为文本型（TEXT）时，需对文本长度进行限制，最大支持10240字节                                                                              |
| 最大元素个数 | 当数据类型为数组时，需要设置数组最大长度                                                                                                 |
| 元素类型     | 当数据类型为数组时，需要针对数组中元素类型进行定义，保证数组中每个对象都是同一类型                                                                            |
| 读写类型     | R:只读W:可写RW:可读可写                                                                                                      |
| 描述         | 输入文字，对该功能进行说明或备注。长度限制为200个字符。                                                                                        |

### **添加自定义事件**

选择功能类型为事件，进行相关参数填充，完成自定义事件创建。

<a data-fancybox title="img" href="/guide/image2022-3-22_10-3-21.png">![img](/guide/image2022-3-22_10-3-21.png)</a>

事件参数说明

| 属性     | 描述                                                         |
| :------- | :----------------------------------------------------------- |
| 功能名称 | 事件的名称，例如：过压告警。同一产品下功能名称不能重复。支持中文、大小写字母、数字、短划线、下划线、斜杠和小数点，必须以中文、英文或数字开头，不超过 128 个字符 |
| 标识符   | 功能定义标识符，与id一一对应，用于应用端与设备交互关键字段。每个物模型版本下属性、事件、服务唯一。 |
| 事件类型 | 信息：指设备上报的一般性通知，例如：完成某项任务。<br />告警：设备运行过程中主动上报的突发或异常情况，告警类信息，优先级高。<br />故障：设备运行过程中主动上报的突发或异常情况，故障类信息，优先级高。 |
| 输出参数 | 该事件的出参。单击“添加参数”，在弹窗对话框中添加一个事件出参。您可以使用某个属性作为出参，也可以自定义参数。例如：将已定义的属性电压作为出参，则设备上报该故障事件时，将携带当前设备的电压值，用于进一步判断故障原因。 |
| 描述     | 输入文字，对该功能进行说明或备注。长度限制为200个字符。      |

### **添加自定义服务**

选择功能类型为服务，进行相关参数填充，完成自定义服务创建。

<a data-fancybox title="img" href="/guide/image2022-3-22_10-3-45.png">![img](/guide/image2022-3-22_10-3-45.png)</a>

服务参数说明

| 属性     | 描述                                                         |
| :------- | :----------------------------------------------------------- |
| 功能名称 | 服务的名称，例如：开合闸。同一产品下功能名称不能重复。支持中文、大小写字母、数字、短划线、下划线、斜杠和小数点，必须以中文、英文或数字开头，不超过 128 个字符 |
| 标识符   | 功能定义标识符，与id一一对应，用于应用端与设备交互关键字段。每个物模型版本下属性、事件、服务唯一。 |
| 调用方法 | 异步：服务为异步调用时，云端执行调用后直接返回结果，不会等待设备的回复消息。<br />同步：服务为同步调用时，云端会等待设备回复；若设备没有回复，则调用超时。（暂不支持） |
| 输入参数 | 设置该服务的入参，可选。单击“添加参数”，在弹窗对话框中添加服务入参。您可以使用某个属性作为入参，也可以自定义参数。 |
| 输出参数 | 设置该服务的出参，可选。单击“添加参数”，在弹窗对话框中添加服务出参。您可以使用某个属性作为出参，也可以自定义参数。 |
| 描述     | 输入文字，对该功能进行说明或备注。长度限制为200个字符。      |

## **批量添加自定义功能**

### **操作步骤**

1.登录开发者中心后，点击产品面板或者面板上“设备开发”按钮，则会进入产品开发流程。

2.在“功能定义”步骤点击面板上“草稿模式”，进入草稿编辑页面。

3.点击“快速导入”按钮，出现下图弹框

<a data-fancybox title="img" href="/guide/image2022-3-22_10-4-58.png">![img](/guide/image2022-3-22_10-4-58.png)</a>

支持两种批量添加方法。

- 在拷贝产品页签，选择物模型源产品和物模型版本。单击确定。源产品对应版本的默认模块和自定义模块物模型都会导入。您可在功能定义的编辑草稿页面，单击模块下功能对应的编辑按钮，修改该功能定义。

- 在导入物模型页签，上传物模型单个JSON文件/Excel文件。

## **更新自定义功能**

### **前提条件**

- 已添加自定义功能

### **操作步骤**

1.登录开发者中心后，点击产品面板或者面板上“设备开发”按钮，则会进入产品开发流程。

2.在“功能定义”步骤点击面板上“草稿模式”，进入草稿编辑页面。

3.点击自定义功能列表中的“编辑” 按钮，出现下图弹框

<a data-fancybox title="img" href="/guide/image2022-3-22_10-31-8.png">![img](/guide/image2022-3-22_10-31-8.png)</a>

在编辑页面上，可以对当前功能的名称、数据类型、标识符等进行修改，但是不能更改当前功能的类型。



## **删除自定义功能**

### **前提条件**

- 已添加自定义功能

### **操作步骤**

1.登录开发者中心后，点击产品面板或者面板上“设备开发”按钮，则会进入产品开发流程。

2.在“功能定义”步骤点击面板上“草稿模式”，进入草稿编辑页面。

3.点击自定义功能列表中的“删除” 按钮，出现下图提示，点击确认，删除此功能定义。

<a data-fancybox title="img" href="/guide/image2022-5-9.png">![img](/guide/image2022-5-9.png)</a>
