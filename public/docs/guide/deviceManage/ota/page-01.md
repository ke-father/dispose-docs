# OTA概述

## **什么是OTA**

OTA全称为Over-the-Air Technology,中文即为空中下载技术。OTA在物联网中的主要应用是为设备更新模组固件或MCU固件，使固件升级变得无需物理访问，节省了已出售产品召回、固件烧录所需的经费和时间。



## **OTA升级流程**

<a data-fancybox title="img" href="/guide/image2022-3-10_21-11-2.png?version=1&modificationDate=1646917270000&api=v2">![img](/guide/image2022-3-10_21-11-2.png?version=1&modificationDate=1646917270000&api=v2)</a>

升级流程说明

**使用OTA升级功能前，请确保设备端已完成OTA升级服务开发。**

1.用户登录开发者中心，添加升级的目标版本，上传升级包。

2.用户创建升级计划，选择升级的产品，添加升级组件，为每个组件添加升级包，配置升级策略。

3.计划配置无误后，点击激活计划，此时计划正式生效。

4.此时设备上线向平台发起请求OTA指令，携带当前设备模组固件版本，MCU固件版本列表。

5.平台收到设备OTA指令后，检查此设备是否存在升级计划，若存在则校验计划中源版本与设备上报版本是否一致，同时校验是否满足计划升级策略。

6.若一切验证通过，则向设备发送满足条件的计划信息，包括组件标识、组件类型、源版本、目标版本以及升级策略信息等。

7.设备收到平台下发的计划信息，根据当前的设备状态比较计划信息判断是否确认升级，若条件允许，则向平台上报确认升级指令。

8.平台在收到设备确认升级指令后，根据组件的升级顺序下发每个组件的升级包地址。

9.设备根据收到的升级包下载地址向OSS服务请求下载固件。

10.下载完成固件后，设备对固件进行更新

11.更新固件的同时会向平台不断的上报升级进度，具体上报的设备进度详见 设备组件升级日志。

12.平台收到设备上报的进度会保存这些进度日志，同时展现的平台，使客户能够直观的了解每个设备的升级详情。

13.设备在更新完固件后重启，重启完成后连云会同时上报当前版本给平台。

14.平台在收到设备上报版本后，会比较是否与计划中目标版本一致，一致则记录设备升级成功。



## **平台OTA能力说明**

| 功能     | 描述                                                                                                                 |
| :------- |:-------------------------------------------------------------------------------------------------------------------|
| 支持协议 | 开发者中心支持MQTT协议、<span v-if="!isEu">LwM2M协议、</span>Http协议的设备OTA                                                       |
| 升级包   | 支持整包、差分包。整包最大支持100M，支持的升级包格式有.bin,.zip,.rar,.pack,.mini_1,.mini_2,.tar,.tar.gz,.s19,bin_1,bin_2。差分升级支持多源版本升级至同一目标版本，无需关注设备源版本。 |
| 组件类型 | 一个计划同时支持模组固件以及MCU固件升级|
| 升级范围 | 支持产品级设备批次升级，同时可通过添加白名单、黑名单方式排除特殊情况。最大同时支持10000设备同时升级。|
| 升级策略 | 可配置升级方式，升级的最低信号强度，最低电量保护以及失败重试次数。|
| 升级计划 | 支持单设备多计划运行，在设备完成一个升级计划后可立即开始后续升级计划进行。  |
| 支持地域 | 支持全球设备OTA能力。 |
| 升级监控 | 支持设备升级实时监控，统计升级成功率    |

  



